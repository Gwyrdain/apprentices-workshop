<%- model_class = Reset -%>
<div class="panel panel-default monospace">
  <div class="panel-heading">
    <%= render 'areas/quick_links', :model_class => model_class %>
    <h5>
      <%=t '.title', :default => model_class.model_name.human.pluralize.titleize %>
      <%= link_to new_area_reset_path(@area), :class => 'btn btn-xs', :title => "#{ t('.new', :default => t('helpers.links.new')) }" do %>
        <%= glyph 'plus' %>
      <%- end -%>
        <div class="pull-right btn-xs">
          <font color=lightgray>
            [ Counts: <%=  "M:#{@area.resets.where(:reset_type => 'M').count} |
                            Q:#{@area.resets.where(:reset_type => 'Q').count} |
                            O:#{@area.resets.where(:reset_type => 'O').count} |
                            I:#{@area.resets.where(:reset_type => 'I').count} |
                            P:#{@area.resets.where(:reset_type => 'P').count} |
                            R:#{@area.resets.where(:reset_type => 'R').count} |
                            E:#{@area.sub_resets.where(:reset_type => 'E').count} |
                            F:#{@area.sub_resets.where(:reset_type => 'F').count} |
                            G:#{@area.sub_resets.where(:reset_type => 'G').count} |
                            C:#{@area.sub_resets.where(:reset_type => 'C').count} |
                            D:#{@area.door_reset_count}" %>
            ]
          </font>
        </div>
    </h5>
  </div>

      <table class="table table-hover monospace">
        <thead>
          <tr>
            <th>Type</th>

            <th>Description</th>
            <th><%=t '.actions', :default => t("helpers.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @resets.order(:reset_type, :val_2).where(reset_type: ['M','Q', 'O', 'R']).each do |reset| %>
            <tr>
              <td><%= reset.desc_brief %></td>
              <td><%= reset.output.match(/^\w \d* (\d*)/)[1] %></td>
              <td>
                <%= reset.comment(true)%>
                <% if reset.is_container %>
                  </br>Container capacity: <%= reset.container_weight_held %>/<%= reset.container_capacity %>
                <% end %>
                <% if (reset.sub_resets.count > 0) || (reset.area.resets.where(parent_id: reset.id).count > 0) %>
                  <%= render 'resets/sub_resetstable', :reset => reset %>
                <% end %>
              </td>
              <td>
                <%= link_to edit_area_reset_path(@area, reset, :reset_type => reset.reset_type, :parent_type => reset.parent_type, :parent_id => reset.parent_id ), :class => 'btn btn-xs', :title => "#{ t('.edit', :default => t('helpers.links.edit')) }" do %>
                  <%= glyph 'pencil' %>
                <%- end -%>
                <%= link_to area_reset_path(@area, reset), :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-xs', :title => "#{ t('.destroy', :default => t('helpers.links.destroy')) }" do %>
                  <%= glyph 'remove' %>
                <%- end -%>
                <%# if reset.reset_type == 'O' && obj_info(reset.val_2, 'type_word', reset.area) == 'CONTAINER' %>
                <% if reset.is_container %>
                  <%= link_to 'Put', new_area_reset_path(@area, reset, :reset_type => 'P', :parent_type => 'reset', :parent_id => reset.id ), :class => 'btn btn-primary btn-xs' %>
                  <%= link_to 'Insert', new_area_reset_path(@area, reset, :reset_type => 'I', :parent_type => 'reset', :parent_id => reset.id ), :class => 'btn btn-primary btn-xs' %>
                <% end %>
                <% if ( reset.reset_type == 'M' || reset.reset_type == 'Q' ) %>
                  <%= link_to 'Give', new_area_reset_sub_reset_path(@area, reset, :reset_type => 'G' ), :class => 'btn btn-primary btn-xs' %>
                  <% if mobile_info(reset.val_2, 'can_wear?') %>
                    <%= link_to 'Equip', new_area_reset_sub_reset_path(@area, reset, :reset_type => 'E' ), :class => 'btn btn-primary btn-xs' %>
                  <% end %>
                <% end %>
                 <%= link_to 'Copy', new_area_reset_path(@area, :copy_reset => reset.id ), :class => 'btn btn-warning btn-xs' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

    <div class="panel-footer">
      <%= link_to 'New reset', new_area_reset_path(@area) %> |
      <%= link_to 'Back', area_path(@area) %>
      <% if @area.sub_resets.where(:reset_type => 'P').count > 0 %>
       | <%= link_to 'Convert Legecy Put Resets', new_area_reset_path(@area, :convert_legacy => true) %>
      <% end %>
    </div>

</div>

<% if @area.show_formatted_blocks? %>
  <br/>
  <strong class="monospace">Formatted #RESETS Block:</strong>
  <pre><%= render 'resets/resetsblock' %></pre>
  <br/>
<% end %>