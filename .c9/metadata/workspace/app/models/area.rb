{"filter":false,"title":"area.rb","tooltip":"/app/models/area.rb","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":419,"column":38},"end":{"row":419,"column":39},"action":"insert","lines":["9"],"id":8131}],[{"start":{"row":419,"column":39},"end":{"row":419,"column":40},"action":"insert","lines":["-"],"id":8132}],[{"start":{"row":419,"column":40},"end":{"row":419,"column":41},"action":"insert","lines":["]"],"id":8133}],[{"start":{"row":419,"column":41},"end":{"row":419,"column":42},"action":"insert","lines":["*"],"id":8134}],[{"start":{"row":419,"column":42},"end":{"row":419,"column":43},"action":"insert","lines":[")"],"id":8135}],[{"start":{"row":419,"column":35},"end":{"row":419,"column":36},"action":"insert","lines":["("],"id":8136}],[{"start":{"row":419,"column":44},"end":{"row":419,"column":54},"action":"insert","lines":[" ([0-9-]*)"],"id":8137}],[{"start":{"row":419,"column":54},"end":{"row":419,"column":64},"action":"insert","lines":[" ([0-9-]*)"],"id":8138}],[{"start":{"row":419,"column":64},"end":{"row":419,"column":74},"action":"insert","lines":[" ([0-9-]*)"],"id":8139}],[{"start":{"row":419,"column":74},"end":{"row":419,"column":84},"action":"insert","lines":[" ([0-9-]*)"],"id":8140}],[{"start":{"row":421,"column":6},"end":{"row":421,"column":32},"action":"remove","lines":["special_info[\"special_v3\"]"],"id":8141},{"start":{"row":421,"column":6},"end":{"row":421,"column":39},"action":"insert","lines":["special_info[\"name\"] = m[3].strip"]}],[{"start":{"row":421,"column":20},"end":{"row":421,"column":24},"action":"remove","lines":["name"],"id":8142},{"start":{"row":421,"column":20},"end":{"row":421,"column":21},"action":"insert","lines":["e"]}],[{"start":{"row":421,"column":21},"end":{"row":421,"column":22},"action":"insert","lines":["x"],"id":8143}],[{"start":{"row":421,"column":22},"end":{"row":421,"column":23},"action":"insert","lines":["t"],"id":8144}],[{"start":{"row":421,"column":23},"end":{"row":421,"column":24},"action":"insert","lines":["e"],"id":8145}],[{"start":{"row":421,"column":24},"end":{"row":421,"column":25},"action":"insert","lines":["n"],"id":8146}],[{"start":{"row":421,"column":25},"end":{"row":421,"column":26},"action":"insert","lines":["d"],"id":8147}],[{"start":{"row":421,"column":26},"end":{"row":421,"column":27},"action":"insert","lines":["e"],"id":8148}],[{"start":{"row":421,"column":20},"end":{"row":421,"column":27},"action":"remove","lines":["extende"],"id":8149},{"start":{"row":421,"column":20},"end":{"row":421,"column":36},"action":"insert","lines":["extended_value_1"]}],[{"start":{"row":421,"column":43},"end":{"row":421,"column":44},"action":"remove","lines":["3"],"id":8150}],[{"start":{"row":421,"column":43},"end":{"row":421,"column":44},"action":"insert","lines":["1"],"id":8151}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["]"],"id":8152}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["."],"id":8153}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["s"],"id":8154}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["t"],"id":8155}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["r"],"id":8156}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["i"],"id":8157}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":["p"],"id":8158}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":46},"action":"remove","lines":["  "],"id":8159}],[{"start":{"row":421,"column":44},"end":{"row":421,"column":45},"action":"remove","lines":[" "],"id":8160}],[{"start":{"row":421,"column":43},"end":{"row":421,"column":44},"action":"remove","lines":["1"],"id":8161}],[{"start":{"row":421,"column":42},"end":{"row":421,"column":43},"action":"remove","lines":["["],"id":8162}],[{"start":{"row":421,"column":41},"end":{"row":421,"column":42},"action":"remove","lines":["m"],"id":8163}],[{"start":{"row":421,"column":40},"end":{"row":421,"column":41},"action":"remove","lines":[" "],"id":8164}],[{"start":{"row":421,"column":39},"end":{"row":421,"column":40},"action":"remove","lines":["="],"id":8165}],[{"start":{"row":421,"column":50},"end":{"row":422,"column":0},"action":"insert","lines":["",""],"id":8166},{"start":{"row":422,"column":0},"end":{"row":422,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":422,"column":6},"end":{"row":422,"column":50},"action":"insert","lines":["special_info[\"extended_value_1\"] = m[1].to_i"],"id":8167}],[{"start":{"row":422,"column":50},"end":{"row":423,"column":0},"action":"insert","lines":["",""],"id":8168},{"start":{"row":423,"column":0},"end":{"row":423,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":423,"column":6},"end":{"row":423,"column":50},"action":"insert","lines":["special_info[\"extended_value_1\"] = m[1].to_i"],"id":8169}],[{"start":{"row":423,"column":50},"end":{"row":424,"column":0},"action":"insert","lines":["",""],"id":8170},{"start":{"row":424,"column":0},"end":{"row":424,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":424,"column":6},"end":{"row":424,"column":50},"action":"insert","lines":["special_info[\"extended_value_1\"] = m[1].to_i"],"id":8171}],[{"start":{"row":424,"column":50},"end":{"row":425,"column":0},"action":"insert","lines":["",""],"id":8172},{"start":{"row":425,"column":0},"end":{"row":425,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":425,"column":6},"end":{"row":425,"column":50},"action":"insert","lines":["special_info[\"extended_value_1\"] = m[1].to_i"],"id":8173}],[{"start":{"row":425,"column":43},"end":{"row":425,"column":44},"action":"remove","lines":["1"],"id":8174},{"start":{"row":425,"column":43},"end":{"row":425,"column":44},"action":"insert","lines":["5"]}],[{"start":{"row":424,"column":43},"end":{"row":424,"column":44},"action":"remove","lines":["1"],"id":8175},{"start":{"row":424,"column":43},"end":{"row":424,"column":44},"action":"insert","lines":["4"]}],[{"start":{"row":423,"column":43},"end":{"row":423,"column":44},"action":"remove","lines":["1"],"id":8176},{"start":{"row":423,"column":43},"end":{"row":423,"column":44},"action":"insert","lines":["3"]}],[{"start":{"row":422,"column":43},"end":{"row":422,"column":44},"action":"remove","lines":["1"],"id":8177},{"start":{"row":422,"column":43},"end":{"row":422,"column":44},"action":"insert","lines":["2"]}],[{"start":{"row":422,"column":35},"end":{"row":422,"column":36},"action":"remove","lines":["1"],"id":8178},{"start":{"row":422,"column":35},"end":{"row":422,"column":36},"action":"insert","lines":["2"]}],[{"start":{"row":423,"column":35},"end":{"row":423,"column":36},"action":"remove","lines":["1"],"id":8179},{"start":{"row":423,"column":35},"end":{"row":423,"column":36},"action":"insert","lines":["3"]}],[{"start":{"row":424,"column":35},"end":{"row":424,"column":36},"action":"remove","lines":["1"],"id":8180},{"start":{"row":424,"column":35},"end":{"row":424,"column":36},"action":"insert","lines":["4"]}],[{"start":{"row":425,"column":35},"end":{"row":425,"column":36},"action":"remove","lines":["1"],"id":8181},{"start":{"row":425,"column":35},"end":{"row":425,"column":36},"action":"insert","lines":["5"]}],[{"start":{"row":433,"column":3},"end":{"row":434,"column":0},"action":"insert","lines":["",""],"id":8182}],[{"start":{"row":434,"column":0},"end":{"row":435,"column":0},"action":"insert","lines":["",""],"id":8183}],[{"start":{"row":435,"column":0},"end":{"row":466,"column":3},"action":"insert","lines":["def parse_triggers (triggers_block)","  triggers_info = Hash.new","  i = 1","  ","  triggers_block.gsub!(/^\\*.*\\n/,'')","  triggers = triggers_block.split(/\\n/).map(&:strip)","  ","  triggers.each do |trigger|","    trigger_info = Hash.new","","    m = trigger.match(/^(\\w) (\\d*) (\\w*)/)","    if m","      trigger_info[\"type\"] = m[1].strip","      trigger_info[\"vnum\"] = m[2].to_i","      trigger_info[\"name\"] = m[3].strip","    end","    ","    m = trigger.match(/^\\w \\d* \\w* ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*)/)","    if m","      trigger_info[\"extended_value_1\"] = m[1].to_i","      trigger_info[\"extended_value_2\"] = m[2].to_i","      trigger_info[\"extended_value_3\"] = m[3].to_i","      trigger_info[\"extended_value_4\"] = m[4].to_i","      trigger_info[\"extended_value_5\"] = m[5].to_i","    end","    ","    triggers_info[i] = trigger_info","    i = i + 1  ","  end","  ","  return triggers_info","end"],"id":8184}],[{"start":{"row":368,"column":29},"end":{"row":368,"column":37},"action":"remove","lines":["specials"],"id":8185},{"start":{"row":368,"column":29},"end":{"row":368,"column":30},"action":"insert","lines":["t"]}],[{"start":{"row":368,"column":30},"end":{"row":368,"column":31},"action":"insert","lines":["r"],"id":8186}],[{"start":{"row":368,"column":31},"end":{"row":368,"column":32},"action":"insert","lines":["i"],"id":8187}],[{"start":{"row":368,"column":32},"end":{"row":368,"column":33},"action":"insert","lines":["g"],"id":8188}],[{"start":{"row":368,"column":33},"end":{"row":368,"column":34},"action":"insert","lines":["g"],"id":8189}],[{"start":{"row":368,"column":34},"end":{"row":368,"column":35},"action":"insert","lines":["e"],"id":8190}],[{"start":{"row":368,"column":35},"end":{"row":368,"column":36},"action":"insert","lines":["r"],"id":8191}],[{"start":{"row":368,"column":36},"end":{"row":368,"column":37},"action":"insert","lines":["s"],"id":8192}],[{"start":{"row":445,"column":35},"end":{"row":445,"column":41},"action":"insert","lines":["(\\d*) "],"id":8193}],[{"start":{"row":449,"column":20},"end":{"row":449,"column":24},"action":"remove","lines":["name"],"id":8194},{"start":{"row":449,"column":20},"end":{"row":449,"column":21},"action":"insert","lines":["d"]}],[{"start":{"row":449,"column":21},"end":{"row":449,"column":22},"action":"insert","lines":["o"],"id":8195}],[{"start":{"row":449,"column":22},"end":{"row":449,"column":23},"action":"insert","lines":["o"],"id":8196}],[{"start":{"row":449,"column":23},"end":{"row":449,"column":24},"action":"insert","lines":["r"],"id":8197}],[{"start":{"row":449,"column":34},"end":{"row":449,"column":39},"action":"remove","lines":["strip"],"id":8198},{"start":{"row":449,"column":34},"end":{"row":449,"column":38},"action":"insert","lines":["to_i"]}],[{"start":{"row":449,"column":38},"end":{"row":450,"column":0},"action":"insert","lines":["",""],"id":8199},{"start":{"row":450,"column":0},"end":{"row":450,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":450,"column":6},"end":{"row":450,"column":39},"action":"insert","lines":["trigger_info[\"type\"] = m[1].strip"],"id":8200}],[{"start":{"row":450,"column":20},"end":{"row":450,"column":24},"action":"remove","lines":["type"],"id":8201},{"start":{"row":450,"column":20},"end":{"row":450,"column":21},"action":"insert","lines":["n"]}],[{"start":{"row":450,"column":21},"end":{"row":450,"column":22},"action":"insert","lines":["a"],"id":8202}],[{"start":{"row":450,"column":22},"end":{"row":450,"column":23},"action":"insert","lines":["m"],"id":8203}],[{"start":{"row":450,"column":23},"end":{"row":450,"column":24},"action":"insert","lines":["e"],"id":8204}],[{"start":{"row":450,"column":31},"end":{"row":450,"column":32},"action":"insert","lines":["4"],"id":8205}],[{"start":{"row":450,"column":32},"end":{"row":450,"column":33},"action":"remove","lines":["1"],"id":8206}],[{"start":{"row":453,"column":35},"end":{"row":453,"column":38},"action":"insert","lines":["\\w*"],"id":8207}],[{"start":{"row":453,"column":38},"end":{"row":453,"column":39},"action":"insert","lines":[" "],"id":8208}],[{"start":{"row":321,"column":19},"end":{"row":321,"column":36},"action":"remove","lines":["'No Resets Block'"],"id":8209},{"start":{"row":321,"column":19},"end":{"row":321,"column":22},"action":"insert","lines":["nil"]}],[{"start":{"row":322,"column":18},"end":{"row":322,"column":34},"action":"remove","lines":["'No Shops Block'"],"id":8210},{"start":{"row":322,"column":18},"end":{"row":322,"column":21},"action":"insert","lines":["nil"]}],[{"start":{"row":323,"column":21},"end":{"row":323,"column":40},"action":"remove","lines":["'No Specials Block'"],"id":8211},{"start":{"row":323,"column":21},"end":{"row":323,"column":24},"action":"insert","lines":["nil"]}],[{"start":{"row":324,"column":19},"end":{"row":324,"column":43},"action":"remove","lines":["'No Room Specials Block'"],"id":8212},{"start":{"row":324,"column":19},"end":{"row":324,"column":22},"action":"insert","lines":["nil"]}],[{"start":{"row":325,"column":21},"end":{"row":325,"column":40},"action":"remove","lines":["'No Triggers Block'"],"id":8213},{"start":{"row":325,"column":21},"end":{"row":325,"column":24},"action":"insert","lines":["nil"]}],[{"start":{"row":320,"column":2},"end":{"row":320,"column":4},"action":"remove","lines":["  "],"id":8214}],[{"start":{"row":320,"column":0},"end":{"row":320,"column":2},"action":"remove","lines":["  "],"id":8215}],[{"start":{"row":319,"column":23},"end":{"row":320,"column":0},"action":"remove","lines":["",""],"id":8216}],[{"start":{"row":146,"column":2},"end":{"row":146,"column":4},"action":"remove","lines":["  "],"id":8217}],[{"start":{"row":146,"column":0},"end":{"row":146,"column":2},"action":"remove","lines":["  "],"id":8218}],[{"start":{"row":145,"column":4},"end":{"row":146,"column":0},"action":"remove","lines":["",""],"id":8219}],[{"start":{"row":145,"column":2},"end":{"row":145,"column":4},"action":"remove","lines":["  "],"id":8220}],[{"start":{"row":145,"column":0},"end":{"row":145,"column":2},"action":"remove","lines":["  "],"id":8221}],[{"start":{"row":144,"column":4},"end":{"row":145,"column":0},"action":"remove","lines":["",""],"id":8222}],[{"start":{"row":140,"column":0},"end":{"row":140,"column":29},"action":"remove","lines":["    # Parse the Objects Block"],"id":8223}],[{"start":{"row":136,"column":0},"end":{"row":136,"column":29},"action":"remove","lines":["    # Parse the Mobiles Block"],"id":8224}],[{"start":{"row":131,"column":0},"end":{"row":131,"column":26},"action":"remove","lines":["    # Parse v2 Header Info"],"id":8225}],[{"start":{"row":126,"column":0},"end":{"row":126,"column":26},"action":"remove","lines":["    # Parse v1 Header Info"],"id":8226}],[{"start":{"row":125,"column":4},"end":{"row":126,"column":0},"action":"remove","lines":["",""],"id":8227}],[{"start":{"row":398,"column":0},"end":{"row":463,"column":3},"action":"remove","lines":["def parse_specials (specials_block)","  specials_info = Hash.new","  i = 1","  ","  specials_block.gsub!(/^\\*.*\\n/,'')","  specials = specials_block.split(/\\n/).map(&:strip)","  ","  specials.each do |special|","    special_info = Hash.new","","    m = special.match(/^(\\w) (\\d*) (\\w*)/)","    if m","      special_info[\"type\"] = m[1].strip","      special_info[\"vnum\"] = m[2].to_i","      special_info[\"name\"] = m[3].strip","    end","    ","    m = special.match(/^\\w \\d* \\w* ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*)/)","    if m","      special_info[\"extended_value_1\"] = m[1].to_i","      special_info[\"extended_value_2\"] = m[2].to_i","      special_info[\"extended_value_3\"] = m[3].to_i","      special_info[\"extended_value_4\"] = m[4].to_i","      special_info[\"extended_value_5\"] = m[5].to_i","    end","    ","    specials_info[i] = special_info","    i = i + 1  ","  end","  ","  return specials_info","end","","def parse_triggers (triggers_block)","  triggers_info = Hash.new","  i = 1","  ","  triggers_block.gsub!(/^\\*.*\\n/,'')","  triggers = triggers_block.split(/\\n/).map(&:strip)","  ","  triggers.each do |trigger|","    trigger_info = Hash.new","","    m = trigger.match(/^(\\w) (\\d*) (\\d*) (\\w*)/)","    if m","      trigger_info[\"type\"] = m[1].strip","      trigger_info[\"vnum\"] = m[2].to_i","      trigger_info[\"door\"] = m[3].to_i","      trigger_info[\"name\"] = m[4].strip","    end","    ","    m = trigger.match(/^\\w \\d* \\w* \\w* ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*) ([0-9-]*)/)","    if m","      trigger_info[\"extended_value_1\"] = m[1].to_i","      trigger_info[\"extended_value_2\"] = m[2].to_i","      trigger_info[\"extended_value_3\"] = m[3].to_i","      trigger_info[\"extended_value_4\"] = m[4].to_i","      trigger_info[\"extended_value_5\"] = m[5].to_i","    end","    ","    triggers_info[i] = trigger_info","    i = i + 1  ","  end","  ","  return triggers_info","end"],"id":8228}],[{"start":{"row":102,"column":0},"end":{"row":170,"column":5},"action":"remove","lines":["  def self.import(file, user_id)","","    range_low ||= 0","    range_high ||= 0","    author ||= ''","    name ||= ''","    flags ||= 0","    ","    area_file = file.read.encode(universal_newline: true).gsub(/\\s*\\n/,\"\\n\")","    #lines = area_file.readlines.map(&:chomp) #readlines from file & removes newline symbol","","    header_v1 = 'No Format 1 Area Header'","    header_v2 = 'No Format 2 Area Header'","    mobiles_block = 'No Mobiles Block'","    objects_block = 'No Objects Block'","    rooms_block = 'No Rooms Block'","    strings_block = 'No Strings Block'","    resets_block = 'No Resets Block'","    shops_block = 'No Shops Block'","    specials_block = 'No Specials Block'","    rspecs_block = 'No Room Specials Block'","    triggers_block = 'No Triggers Block'","    header_info = ''","    ","    if area_file.match(/^#AREA.*~.*?\\n/)","      header_v1 = area_file.match(/^#AREA.*~.*?\\n/)","      header_info = parse_area_header_v1(header_v1[0], user_id)","    end","","    if area_file.match(/^#AREA.*?\\nEnd/m)","      header_v2 = area_file.match(/^#AREA.*?\\nEnd/m)","      header_info = parse_area_header_v2(header_v2[0], user_id)","    end","","    if area_file.match(/^#MOBILES\\n#(.*?)\\n#0/m)","      mobiles_block = parse_mobiles( area_file.match(/^#MOBILES\\n#(.*?)\\n#0/m)[1] )","    end","","    if area_file.match(/^#OBJECTS\\n#.*?\\n#0/m)","      objects_block = parse_objects( area_file.match(/^#OBJECTS\\n#(.*?)\\n#0/m)[1] )","    end","    ","    if area_file.match(/^#ROOMS\\n#.*?\\n#0/m)","      rooms_block = area_file.match(/^#ROOMS\\n#(.*?)\\n#0/m)","    end","    if area_file.match(/^#STRINGS\\n#.*?\\n#0/m)","      strings_block = area_file.match(/^#STRINGS\\n#(.*?)\\n#0/m)","    end","    if area_file.match(/^#RESETS\\n.*?\\nS/m)","      resets_block = area_file.match(/^#RESETS\\n.*?\\nS/m)","    end","    if area_file.match(/^#SHOPS\\n.*?\\n0/m)","      shops_block = area_file.match(/^#SHOPS\\n.*?\\n0/m)","    end","    if area_file.match(/^#SPECIALS\\n.*?\\nS/m)","      specials_block = area_file.match(/^#SPECIALS\\n.*?\\nS/m)","    end","    if area_file.match(/^#RSPECS\\n.*?\\nS/m)","      rspecs_block = area_file.match(/^#RSPECS\\n.*?\\nS/m)","    end","    if area_file.match(/^#TRIGGERS\\n.*?\\nS/m)","      triggers_block = area_file.match(/^#TRIGGERS\\n.*?\\nS/m)","    end","","    return \"#{header_info}<hr>#{header_v1}<hr>#{header_v2}<hr>#{mobiles_block}<hr>#{objects_block}<hr>\" <<","           \"#{rooms_block}<hr>#{strings_block}<hr>#{resets_block}<hr>#{shops_block}\" <<","           \"#{specials_block}<hr>#{rspecs_block}<hr>#{triggers_block}<hr><b>EOF</b>\"","","  end"],"id":8229}],[{"start":{"row":102,"column":0},"end":{"row":103,"column":2},"action":"remove","lines":["","  "],"id":8230}],[{"start":{"row":102,"column":0},"end":{"row":103,"column":0},"action":"remove","lines":["",""],"id":8231}]]},"ace":{"folds":[],"scrolltop":386,"scrollleft":0,"selection":{"start":{"row":31,"column":0},"end":{"row":40,"column":48},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1460914798000,"hash":"2280f244a15bfec6dcd2466d3e33669c56635aec"}